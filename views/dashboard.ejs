<!doctype html>
<html>
    <head>
		<meta charset="utf-8">
		<meta name="author" content="Grzegorz Babiarz">
		<title>Messenger</title>
		<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
		<link rel="stylesheet" href="../css/fontello.css">
		<link rel="stylesheet" href="../css/styles.css">
        <script src="/socket.io/socket.io.js"></script>
		<script src="http://code.jquery.com/jquery-3.4.0.min.js"></script>
		<script src="../js/jquery.playSound.js"></script>
        <script src="../js/scripts.js"></script>
    </head>
    <body>
		<section class="left">
			<header>
				<h1><%= user.firstname %> <%= user.lastname %></h1>
			</header>
			<section class="list">
				<section class="search">
					<form id="search-form" autocomplete="off">
						<input type="text" placeholder="Szukaj osób" id="search">
					</form>
				</section>
				<ul id="people">
					<% if(chats.length > 0) { %>
						<% chats.forEach(function(chat, i) { %>
							<li><a href="#<%= chat.id %>" class="chat <% if(i == 0) { %>active<% } %>" data-id="<%= chat.id %>" data-type="<% if(chat.private == 1) { %>private<%  } else { %>public<% } %>"><%= chat.name %><span class="details"><%= chat.text %></span></a></li>
						<% }); %>
					<% } else { %>
						<div class="center"><i class="icon-up"></i><br>Brak utworzonych czatów.<br>Wyszukaj osoby aby utworzyć czat</div>
					<% } %>
				</ul>
			</section>
			<div class="btn-circle" id="create-group-chat" title="Utwórz czat grupowy"><i class="icon-plus"></i></div>
			<div class="create-group-form"><input type="text" class="group-name" placeholder="Nazwa czatu"><button class="create-group"><i class="icon-ok"></i></button></div>
		</section>
		<section class="right">
			<header>
				<h1>Messenger <a href="/logout"><i class="icon-logout"></i></a></h1>
			</header>
			<section class="preview">
				<section class="messages">
						<ul id="messages">
								<% messages.forEach(function(msg) {
									if(msg.sender_id == user.id) {
										if(msg.removed !== null) { %>
											<li style="text-align: right"><span class="message msg-own removed" style="background-color: #<%= chats[0].color %>;" title="<%= 'Nadawca: '+user.firstname+' '+user.lastname+'\r\n Wysłano: '+msg.sent+'\r\nUsunięto: '+msg.removed %>" data-id="<%= msg.id %>"><%= msg.text %></span></li>
										<% } else { %>
											<li style="text-align: right"><span class="message msg-own" style="background-color: #<%= chats[0].color %>;" title="<%= 'Nadawca: '+user.firstname+' '+user.lastname+'\r\nWysłano: '+msg.sent %>" data-id="<%= msg.id %>"><%= msg.text %></span></li>
										<% }
									} else if(msg.sender_id == null) { %>
										<li style="text-align: center"><span class="msg-info" title="<%= msg.sent %>"><%= msg.text %></span></li>
									<% } else {
										if(msg.removed !== null) { %>
											<li><span class="message msg-default removed" title="<%= 'Nadawca: '+msg.sender+'\r\nWysłano: '+msg.sent+'\r\nUsunięto: '+msg.removed %>"><%= msg.text %></span></li>
										<% } else { %>
											<li><span class="message msg-default" title="<%= 'Nadawca: '+msg.sender+'\r\nWysłano: '+msg.sent %>"><%= msg.text %></span></li>
										<% }
									}
								}); %>
							</ul>
				</section>
				<section class="chat-info">
					<header>
						<h3 class="chat-name search">
							<% if(chats.length > 0) { %>
								<%= chat.name %>
							<% } %>
						</h3>
					</header>
					<section>
						<ul class="options">
							<% if(chats.length > 0) { 
								if(chat.private) { %>
									<li><i class="icon-user"></i>Nazwa użytkownika: <%= chat.username %></li>
									<li><i class="icon-clock"></i>Data rejestracji: <%= chat.register_date %></li>
									<li class="option-active"><i class="icon-pencil"></i>Zmień nick</li>
									<li class="option-active set-color"><i class="icon-color-adjust"></i>Zmień kolor czatu</li>
								
								<% } else { %>
									<li><i class="icon-users"></i><%= chat.members %> członków</li>
									<li><i class="icon-clock"></i>Utworzono <%= chat.creation_date %></li>
									<li class="option-active edit-name"><i class="icon-pencil"></i>Zmień nazwę</li>
									<li class="option-active"><i class="icon-pencil"></i>Zmień nicki</li>
									<li class="option-active set-color"><i class="icon-color-adjust"></i>Zmień kolor czatu<!--<input type="color" class="color-picker" value="#ff0000">--></li>
									<li class="option-active add-members"><i class="icon-user-plus"></i>Dodaj osoby</li>
									<li class="option-active remove-members"><i class="icon-user-times"></i>Usuń osoby</li>
								<% }
							} %>
						</ul>
					</section>
				</section>
			</section>
			<section class="form">
				<form class="msg-form" autocomplete="off">
					<input type="text" placeholder="Wiadomość" id="msg">
					<!--<a href="" class="text-btn" id="send-photo"><i class="icon-picture"></i></a>&nbsp;-->
					<input type="submit" value="Wyślij" class="text-btn" id="send">
				</form>
			</section>
		</section>
		<span class="version"><%= version %></span>
    </body>
</html>